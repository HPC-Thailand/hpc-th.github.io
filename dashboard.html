<!DOCTYPE html    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet"><html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>HPC Thailand - Analytics Dashboard</title>
    
    <!-- SEO and Social Media Meta Tags -->
    <meta name="description" content="Advanced analytics dashboard for Thailand's HPC infrastructure with interactive charts and insights" />
    <meta name="keywords" content="HPC Analytics, Thailand Supercomputers, Data Visualization, Performance Metrics" />
    
    <!-- Favicon -->
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Ctext y='.9em' font-size='90'%3E⚡%3C/text%3E%3C/svg%3E" />
    
    <!-- Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet" />
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <style>
        /* Custom CSS Variables */
        :root {
            --primary: #3b82f6;
            --primary-dark: #1d4ed8;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --background: #0f0f23;
            --surface: #1a1a2e;
            --text-primary: #ffffff;
            --text-secondary: #94a3b8;
            --border: #374151;
            --glow: #3b82f650;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
          body {
            font-family: 'Noto Sans Thai', sans-serif;
            background: linear-gradient(135deg, var(--background) 0%, #1a1a2e 100%);
            color: var(--text-primary);
            overflow-x: hidden;
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
        }
        
        ::-webkit-scrollbar-track {
            background: var(--surface);
        }
        
        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }
        
        /* Glassmorphism effect */
        .glass {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Gradient text */
        .gradient-text {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }        /* Magic UI inspired components */
        .magic-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            backdrop-filter: blur(20px);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            opacity: 1;
        }
        
        .magic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.1), transparent);
            transition: left 0.5s;
        }
        
        .magic-card:hover::before {
            left: 100%;
        }        .magic-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 25px 60px rgba(59, 130, 246, 0.3);
            border-color: rgba(59, 130, 246, 0.4);
        }
        
        /* Navigation styles */
        .nav-pill {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            transition: all 0.3s ease;
        }
        
        .nav-pill:hover {
            background: rgba(59, 130, 246, 0.2);
            transform: translateY(-2px);
        }
        
        .nav-pill.active {
            background: var(--primary);
            border-color: var(--primary);
            color: white;
        }
        
        /* Chart containers */
        .chart-container {
            position: relative;
            height: 300px;
        }
        
        .chart-container-large {
            position: relative;
            height: 400px;
        }        /* Metric cards */        .metric-card {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 16px;
            padding: 24px;
            transition: all 0.3s ease;
        }        .metric-card:hover {
            transform: translateY(-4px);
            border-color: rgba(59, 130, 246, 0.4);
            box-shadow: 0 20px 40px rgba(59, 130, 246, 0.2);
        }
        
        /* Progress bars */
        .progress-bar {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50px;
            height: 8px;
            overflow: hidden;
        }
        
        .progress-fill {
            height: 100%;
            border-radius: 50px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            transition: width 1s ease;
        }
        
        /* Animated counter */
        .counter {
            font-variant-numeric: tabular-nums;
        }
        
        /* Custom chart styles */
        .chart-legend {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 16px;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            font-size: 14px;
            color: var(--text-secondary);
        }
        
        .legend-color {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
    </style>
</head>
<body>
    <!-- Main container -->
    <div class="min-h-screen relative">
        <!-- Header -->
        <header class="pt-8 pb-12">
            <div class="max-w-7xl mx-auto px-6">                <!-- Navigation -->
                <nav class="flex justify-center mb-12">
                    <div class="flex space-x-2 p-2 glass rounded-full">
                        <a href="index.html" class="nav-pill px-6 py-3 rounded-full text-sm font-medium transition-all">
                            <span class="material-icons-round text-sm mr-2">table_view</span>
                            Systems
                        </a>
                        <a href="map.html" class="nav-pill px-6 py-3 rounded-full text-sm font-medium transition-all">
                            <span class="material-icons-round text-sm mr-2">map</span>
                            Map
                        </a>
                        <a href="dashboard.html" class="nav-pill active px-6 py-3 rounded-full text-sm font-medium transition-all">
                            <span class="material-icons-round text-sm mr-2">analytics</span>
                            Analytics
                        </a>
                        <a href="timeline.html" class="nav-pill px-6 py-3 rounded-full text-sm font-medium transition-all">
                            <span class="material-icons-round text-sm mr-2">timeline</span>
                            Timeline
                        </a>
                    </div>
                </nav>
                
                <!-- Hero section -->
                <div class="text-center mb-12">
                    <div class="inline-flex items-center px-4 py-2 rounded-full bg-blue-500/10 border border-blue-500/20 text-blue-400 text-sm font-medium mb-6">
                        <span class="material-icons-round text-xs mr-2">insights</span>
                        Real-time Analytics
                    </div>
                    <h1 class="text-4xl md:text-5xl font-bold mb-4 leading-tight">
                        <span class="gradient-text">HPC Analytics</span><br>
                        <span class="text-white">Dashboard</span>
                    </h1>
                    <p class="text-lg text-gray-400 max-w-2xl mx-auto leading-relaxed">
                        Comprehensive insights into Thailand's high-performance computing infrastructure performance and capabilities.
                    </p>
                </div>
            </div>
        </header>
        
        <!-- Key Metrics -->
        <section class="mb-12">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6" id="key-metrics">
                    <!-- Metrics will be populated by JavaScript -->
                    <div class="metric-card text-center">
                        <div class="text-3xl font-bold gradient-text mb-2 counter" data-target="0">0</div>
                        <div class="text-gray-400 text-sm uppercase tracking-wide">Loading...</div>
                    </div>
                    <div class="metric-card text-center">
                        <div class="text-3xl font-bold gradient-text mb-2 counter" data-target="0">0</div>
                        <div class="text-gray-400 text-sm uppercase tracking-wide">Loading...</div>
                    </div>
                    <div class="metric-card text-center">
                        <div class="text-3xl font-bold gradient-text mb-2 counter" data-target="0">0</div>
                        <div class="text-gray-400 text-sm uppercase tracking-wide">Loading...</div>
                    </div>
                    <div class="metric-card text-center">
                        <div class="text-3xl font-bold gradient-text mb-2 counter" data-target="0">0</div>
                        <div class="text-gray-400 text-sm uppercase tracking-wide">Loading...</div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Charts Grid -->
        <section class="mb-12">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- CPU Distribution Chart -->
                    <div class="magic-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <span class="material-icons-round mr-3 text-blue-400">memory</span>
                                CPU Core Distribution
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="cpuChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- GPU Distribution Chart -->
                    <div class="magic-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <span class="material-icons-round mr-3 text-purple-400">graphic_eq</span>
                                GPU Distribution
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="gpuChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Location Distribution Chart -->
                    <div class="magic-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <span class="material-icons-round mr-3 text-cyan-400">location_city</span>
                                Geographic Distribution
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="locationChart"></canvas>
                        </div>
                    </div>
                    
                    <!-- Consortium Distribution Chart -->
                    <div class="magic-card p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-bold text-white flex items-center">
                                <span class="material-icons-round mr-3 text-green-400">groups</span>
                                Consortium Distribution
                            </h3>
                        </div>
                        <div class="chart-container">
                            <canvas id="consortiumChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Performance Metrics -->
        <section class="mb-12">
            <div class="max-w-7xl mx-auto px-6">
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Top Systems by CPU -->
                    <div class="magic-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <span class="material-icons-round mr-3 text-orange-400">trending_up</span>
                            Top Systems by CPU Cores
                        </h3>
                        <div id="top-cpu-systems" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                    
                    <!-- Top Systems by GPU -->
                    <div class="magic-card p-6">
                        <h3 class="text-xl font-bold text-white mb-6 flex items-center">
                            <span class="material-icons-round mr-3 text-pink-400">speed</span>
                            Top Systems by GPUs
                        </h3>
                        <div id="top-gpu-systems" class="space-y-4">
                            <!-- Will be populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- System Summary -->
        <section class="mb-16">
            <div class="max-w-7xl mx-auto px-6">
                <div class="magic-card p-8">
                    <h3 class="text-2xl font-bold text-white mb-6 flex items-center">
                        <span class="material-icons-round mr-3 text-indigo-400">summarize</span>
                        Infrastructure Summary
                    </h3>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="infrastructure-summary">
                        <!-- Will be populated by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer class="py-12 border-t border-gray-800">
            <div class="max-w-7xl mx-auto px-6">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="text-gray-400 text-sm mb-4 md:mb-0">
                        © 2025 HPC Thailand. Open source project for the community.
                    </div>
                    <div class="flex space-x-6">
                        <a href="https://github.com/HPC-Thailand/hpc-th.github.io" target="_blank" class="text-gray-400 hover:text-blue-400 transition-colors">
                            <span class="text-sm">GitHub</span>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition-colors">
                            <span class="text-sm">API</span>
                        </a>
                        <a href="#" class="text-gray-400 hover:text-blue-400 transition-colors">
                            <span class="text-sm">Documentation</span>
                        </a>
                    </div>
                </div>
            </div>
        </footer>
    </div>
    
    <script>
        // Global variables
        let hpcData = [];
        let charts = {};
          // Color palettes with consistent brightness
        const colors = {
            primary: ['#3b82f6', '#1d4ed8', '#1e40af', '#1e3a8a'],
            secondary: ['#8b5cf6', '#7c3aed', '#6d28d9', '#5b21b6'],
            accent: ['#06b6d4', '#0891b2', '#0e7490', '#155e75'],
            success: ['#10b981', '#059669', '#047857', '#065f46'],
            warning: ['#f59e0b', '#d97706', '#b45309', '#92400e'],
            mixed: ['#3b82f6', '#8b5cf6', '#06b6d4', '#10b981', '#f59e0b', '#ef4444', '#ec4899', '#f97316'],            // Enhanced color palette with full opacity for better visibility
            gpuTypes: [
                '#4f46e5', // NVIDIA A100 - Indigo
                '#7c3aed', // NVIDIA H100 - Purple  
                '#2563eb', // NVIDIA V100 - Blue
                '#0891b2', // NVIDIA RTX - Cyan
                '#059669', // NVIDIA Tesla - Green
                '#dc2626', // AMD MI - Red
                '#ea580c', // Intel - Orange
                '#be123c', // Other GPU - Rose
                '#6366f1', // Integrated - Indigo light
                '#8b5cf6'  // Unknown - Purple light
            ],
            // Full opacity bright colors for pie charts
            pieCharts: [
                '#4f46e5', // Indigo
                '#7c3aed', // Purple  
                '#2563eb', // Blue
                '#0891b2', // Cyan
                '#059669', // Green
                '#dc2626', // Red
                '#ea580c', // Orange
                '#be123c', // Rose
                '#6366f1', // Indigo light
                '#8b5cf6'  // Purple light
            ]
        };
          // Initialize the application
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('DOM loaded, initializing...');
            // For now, let's always use fallback data to ensure it works
            loadFallbackData();
            initializeAnimations();
        });// Load HPC data
        async function loadHPCData() {
            try {
                // Try to fetch from JSON file first
                const response = await fetch('./data/hpc-locations.json');
                if (!response.ok) {
                    throw new Error('Failed to fetch data');
                }
                hpcData = await response.json();
                console.log('Data loaded from JSON file:', hpcData.length, 'systems');
                
                updateKeyMetrics();
                createCharts();
                createTopSystemsLists();
                createInfrastructureSummary();
                
            } catch (error) {
                console.error('Error loading HPC data from file, using fallback:', error);
                // Use fallback data for file:// protocol
                loadFallbackData();
            }
        }

        // Fallback data for when JSON can't be loaded
        function loadFallbackData() {
            console.log('Loading fallback data...');
            // Simplified HPC data for demonstration
            hpcData = [                {
                    name: "The Crust 2.5",
                    organization: "PTT Exploration and Production",
                    consortium: ["ThaiSC", "Private"],
                    specs: {
                        cpu: { cores: 47360, type: "Intel Xeon" },
                        gpu: { count: 512, model: "NVIDIA H100", memory: "94GB" }
                    },
                    location: { city: "Bangkok", coordinates: [100.5619, 13.8125] }
                },
                {
                    name: "LANTA",
                    organization: "ThaiSC, NSTDA",
                    consortium: ["ThaiSC", "NSTDA"],
                    specs: {
                        cpu: { cores: 31744, type: "AMD EPYC 7763" },
                        gpu: { count: 704, model: "NVIDIA A100", memory: "40GB" }
                    },
                    location: { city: "Pathum Thani", coordinates: [100.6035, 14.0674] }
                },
                {
                    name: "ERAWAN",
                    organization: "Chiang Mai University",
                    consortium: ["Academic", "University"],
                    specs: {
                        cpu: { cores: 384, type: "Intel Xeon Gold" },
                        gpu: { count: 24, model: "NVIDIA A100", memory: "80GB" }
                    },
                    location: { city: "Chiang Mai", coordinates: [98.9817, 18.7881] }
                },
                {
                    name: "APEX",
                    organization: "CMKL University",
                    consortium: ["Academic", "International"],
                    specs: {
                        cpu: { cores: 2048, type: "Intel Xeon" },
                        gpu: { count: 64, model: "NVIDIA V100", memory: "32GB" }
                    },
                    location: { city: "Bangkok", coordinates: [100.5018, 13.7563] }
                },
                {
                    name: "KU Nontri AI",
                    organization: "Kasetsart University",
                    consortium: ["Academic", "AI Research"],
                    specs: {
                        cpu: { cores: 1536, type: "Intel Xeon" },
                        gpu: { count: 32, model: "NVIDIA RTX A6000", memory: "48GB" }
                    },
                    location: { city: "Bangkok", coordinates: [100.5692, 13.8475] }
                },
                {
                    name: "MU-AI Center",
                    organization: "Mahidol University",
                    consortium: ["Academic", "Medical"],
                    specs: {
                        cpu: { cores: 1024, type: "Intel Xeon" },
                        gpu: { count: 16, model: "NVIDIA A100", memory: "40GB" }
                    },
                    location: { city: "Nakhon Pathom", coordinates: [100.0407, 13.7941] }
                },
                {
                    name: "PSU-Singkhorn",
                    organization: "Prince of Songkla University",
                    consortium: ["Academic", "Regional"],
                    specs: {
                        cpu: { cores: 512, type: "Intel Xeon" },
                        gpu: { count: 8, model: "NVIDIA RTX 3090", memory: "24GB" }
                    },
                    location: { city: "Songkhla", coordinates: [100.5950, 7.0085] }
                },
                {
                    name: "KKU HPC",
                    organization: "Khon Kaen University",
                    consortium: ["Academic", "Northeast"],
                    specs: {
                        cpu: { cores: 256, type: "Intel Xeon" },
                        gpu: { count: 4, model: "NVIDIA Tesla V100", memory: "16GB" }
                    },
                    location: { city: "Khon Kaen", coordinates: [102.8143, 16.4322] }
                }
            ];
            
            console.log('Fallback data loaded:', hpcData.length, 'systems');
            console.log('Sample data:', hpcData[0]);
            
            updateKeyMetrics();
            createCharts();
            createTopSystemsLists();
            createInfrastructureSummary();
        }
          // Update key metrics
        function updateKeyMetrics() {
            console.log('updateKeyMetrics called, hpcData:', hpcData);
            
            if (!hpcData || hpcData.length === 0) {
                console.error('No HPC data available');
                return;
            }
            
            const totalSystems = hpcData.length;
            const totalCities = [...new Set(hpcData.map(hpc => hpc.location.city))].length;
            const totalCpuCores = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.cpu?.cores || 0), 0);
            const totalGpus = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.gpu?.count || 0), 0);
            
            console.log('Metrics calculated:', { totalSystems, totalCities, totalCpuCores, totalGpus });
            
            const metrics = [
                { value: totalSystems, label: 'HPC Systems', icon: 'computer' },
                { value: totalCities, label: 'Cities', icon: 'location_city' },
                { value: totalCpuCores, label: 'CPU Cores', icon: 'memory', format: true },
                { value: totalGpus, label: 'GPUs', icon: 'graphic_eq', format: true }
            ];
            
            const metricsContainer = document.getElementById('key-metrics');
            if (!metricsContainer) {
                console.error('key-metrics container not found');
                return;
            }
            
            metricsContainer.innerHTML = '';
            
            metrics.forEach((metric, index) => {
                const card = document.createElement('div');
                card.className = 'metric-card text-center';
                card.style.animationDelay = `${index * 0.1}s`;
                
                card.innerHTML = `
                    <div class="flex items-center justify-center mb-3">
                        <span class="material-icons-round text-blue-400 text-2xl">${metric.icon}</span>
                    </div>
                    <div class="text-3xl font-bold gradient-text mb-2 counter" data-target="${metric.value}">0</div>
                    <div class="text-gray-400 text-sm uppercase tracking-wide">${metric.label}</div>
                `;
                
                metricsContainer.appendChild(card);
            });
            
            // Animate counters
            setTimeout(() => {
                animateCounters();
            }, 100);
        }
        
        // Animate counter numbers
        function animateCounters() {
            const counters = document.querySelectorAll('.counter');
            
            counters.forEach(counter => {
                const target = parseInt(counter.dataset.target);
                const duration = 2000;
                const steps = 60;
                const stepValue = target / steps;
                let current = 0;
                
                const timer = setInterval(() => {
                    current += stepValue;
                    if (current >= target) {
                        current = target;
                        clearInterval(timer);
                    }
                    
                    const displayValue = Math.floor(current);
                    counter.textContent = displayValue > 999 ? displayValue.toLocaleString() : displayValue;
                }, duration / steps);
            });
        }
        
        // Create charts
        function createCharts() {
            createCPUChart();
            createGPUChart();
            createLocationChart();
            createConsortiumChart();
        }
          // Create CPU chart
        function createCPUChart() {
            const ctx = document.getElementById('cpuChart').getContext('2d');
            
            const cpuData = hpcData.map(hpc => ({
                name: hpc.name,
                cores: hpc.specs?.cpu?.cores || 0
            })).sort((a, b) => b.cores - a.cores);

            charts.cpu = new Chart(ctx, {
                type: 'bar',                data: {
                    labels: cpuData.map(d => d.name),                    datasets: [{
                        label: 'CPU Cores',
                        data: cpuData.map(d => d.cores),
                        backgroundColor: colors.pieCharts.slice(0, cpuData.length), // Use full opacity colors like other charts
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },                        tooltip: {
                            backgroundColor: 'rgba(15, 15, 35, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#94a3b8',
                            callbacks: {
                                label: function(context) {
                                    return `${context.dataset.label}: ${context.parsed.y.toLocaleString()} cores`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { 
                                color: '#94a3b8', 
                                maxRotation: 45,
                                font: { size: 10 }
                            },
                            grid: { color: '#374151' }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { 
                                color: '#94a3b8',
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            },
                            grid: { color: '#374151' }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // Create GPU chart
        function createGPUChart() {
            const ctx = document.getElementById('gpuChart').getContext('2d');
            
            // Aggregate GPU data by type instead of system
            const gpuTypeData = {};
            
            hpcData.forEach(hpc => {
                if (hpc.specs?.gpu?.count && hpc.specs?.gpu?.count > 0) {
                    // Extract GPU type from the model string
                    let gpuType = 'Unknown';
                    const gpuModel = hpc.specs.gpu.model || '';
                    
                    if (gpuModel.includes('A100')) gpuType = 'NVIDIA A100';
                    else if (gpuModel.includes('H100')) gpuType = 'NVIDIA H100';
                    else if (gpuModel.includes('V100')) gpuType = 'NVIDIA V100';
                    else if (gpuModel.includes('RTX') || gpuModel.includes('GeForce')) gpuType = 'NVIDIA RTX/GeForce';
                    else if (gpuModel.includes('Tesla') || gpuModel.includes('K80') || gpuModel.includes('P100')) gpuType = 'NVIDIA Tesla';
                    else if (gpuModel.includes('MI') || gpuModel.includes('AMD')) gpuType = 'AMD MI Series';
                    else if (gpuModel.includes('Intel')) gpuType = 'Intel GPU';
                    else if (gpuModel.includes('Integrated') || gpuModel.includes('integrated')) gpuType = 'Integrated GPU';
                    else if (gpuModel && gpuModel !== '') gpuType = 'Other GPU';
                    
                    gpuTypeData[gpuType] = (gpuTypeData[gpuType] || 0) + hpc.specs.gpu.count;
                }
            });
            
            // Sort by count descending
            const sortedGpuData = Object.entries(gpuTypeData)
                .sort((a, b) => b[1] - a[1])
                .map(([type, count]) => ({ type, count }));
            
            charts.gpu = new Chart(ctx, {
                type: 'doughnut',                data: {
                    labels: sortedGpuData.map(d => d.type),
                    datasets: [{                        data: sortedGpuData.map(d => d.count),
                        backgroundColor: colors.pieCharts.slice(0, sortedGpuData.length) // Use full opacity colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                color: '#94a3b8', 
                                font: { size: 11 },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }
                        },                        tooltip: {
                            backgroundColor: 'rgba(15, 15, 35, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#94a3b8',
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed.toLocaleString()} GPUs (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        duration: 1500
                    }
                }
            });
        }
          // Create location chart
        function createLocationChart() {
            const ctx = document.getElementById('locationChart').getContext('2d');
            
            const locationCount = {};
            hpcData.forEach(hpc => {
                const city = hpc.location.city;
                locationCount[city] = (locationCount[city] || 0) + 1;
            });
            
            const locationData = Object.entries(locationCount).sort((a, b) => b[1] - a[1]);
              charts.location = new Chart(ctx, {
                type: 'pie',                data: {
                    labels: locationData.map(d => d[0]),                    datasets: [{
                        data: locationData.map(d => d[1]),
                        backgroundColor: colors.pieCharts.slice(0, locationData.length) // Use full opacity colors
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: { 
                                color: '#94a3b8', 
                                font: { size: 11 },
                                padding: 15,
                                usePointStyle: true,
                                pointStyle: 'circle'
                            }                        },                        tooltip: {
                            backgroundColor: 'rgba(15, 15, 35, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#94a3b8',
                            callbacks: {
                                label: function(context) {
                                    const total = context.dataset.data.reduce((a, b) => a + b, 0);
                                    const percentage = ((context.parsed / total) * 100).toFixed(1);
                                    return `${context.label}: ${context.parsed} systems (${percentage}%)`;
                                }
                            }
                        }
                    },
                    animation: {
                        animateRotate: true,
                        duration: 1500
                    }
                }
            });
        }
        
        // Create consortium chart
        function createConsortiumChart() {
            const ctx = document.getElementById('consortiumChart').getContext('2d');
            
            const consortiumCount = {};
            hpcData.forEach(hpc => {
                (hpc.consortium || ['Unknown']).forEach(consortium => {
                    consortiumCount[consortium] = (consortiumCount[consortium] || 0) + 1;
                });
            });
            
            const consortiumData = Object.entries(consortiumCount).sort((a, b) => b[1] - a[1]);
              charts.consortium = new Chart(ctx, {
                type: 'bar',                data: {
                    labels: consortiumData.map(d => d[0]),
                    datasets: [{
                        label: 'Systems Count',                        data: consortiumData.map(d => d[1]),
                        backgroundColor: colors.pieCharts.slice(0, consortiumData.length), // Use full opacity colors
                        borderRadius: 8,
                        borderSkipped: false
                    }]
                },options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },                        tooltip: {
                            backgroundColor: 'rgba(15, 15, 35, 0.9)',
                            titleColor: '#ffffff',
                            bodyColor: '#94a3b8',
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.parsed.y} systems`;
                                }
                            }
                        }
                    },
                    scales: {
                        x: {
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#374151' }
                        },
                        y: {
                            beginAtZero: true,
                            ticks: { color: '#94a3b8' },
                            grid: { color: '#374151' }
                        }
                    },
                    animation: {
                        duration: 1500,
                        easing: 'easeOutQuart'
                    }
                }
            });
        }
        
        // Create top systems lists
        function createTopSystemsLists() {
            createTopCPUSystems();
            createTopGPUSystems();
        }
        
        // Create top CPU systems list
        function createTopCPUSystems() {
            const topCPU = hpcData
                .sort((a, b) => (b.specs?.cpu?.cores || 0) - (a.specs?.cpu?.cores || 0))
                .slice(0, 5);
            
            const container = document.getElementById('top-cpu-systems');
            container.innerHTML = '';
            
            const maxCores = topCPU[0]?.specs?.cpu?.cores || 1;
            
            topCPU.forEach((hpc, index) => {
                const cores = hpc.specs?.cpu?.cores || 0;
                const percentage = (cores / maxCores) * 100;
                
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 rounded-lg bg-gray-800/30';
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-blue-500 to-purple-500 flex items-center justify-center text-white text-sm font-bold">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="text-white font-medium">${hpc.name}</div>
                            <div class="text-gray-400 text-sm">${hpc.organization}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-blue-400 font-bold">${cores.toLocaleString()}</div>
                        <div class="text-gray-400 text-sm">cores</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // Create top GPU systems list
        function createTopGPUSystems() {
            const topGPU = hpcData
                .sort((a, b) => (b.specs?.gpu?.count || 0) - (a.specs?.gpu?.count || 0))
                .slice(0, 5);
            
            const container = document.getElementById('top-gpu-systems');
            container.innerHTML = '';
            
            const maxGPUs = topGPU[0]?.specs?.gpu?.count || 1;
            
            topGPU.forEach((hpc, index) => {
                const gpus = hpc.specs?.gpu?.count || 0;
                const percentage = (gpus / maxGPUs) * 100;
                
                const item = document.createElement('div');
                item.className = 'flex items-center justify-between p-3 rounded-lg bg-gray-800/30';
                item.innerHTML = `
                    <div class="flex items-center space-x-3">
                        <div class="w-8 h-8 rounded-full bg-gradient-to-r from-pink-500 to-purple-500 flex items-center justify-center text-white text-sm font-bold">
                            ${index + 1}
                        </div>
                        <div>
                            <div class="text-white font-medium">${hpc.name}</div>
                            <div class="text-gray-400 text-sm">${hpc.specs?.gpu?.type || 'N/A'}</div>
                        </div>
                    </div>
                    <div class="text-right">
                        <div class="text-pink-400 font-bold">${gpus.toLocaleString()}</div>
                        <div class="text-gray-400 text-sm">GPUs</div>
                    </div>
                `;
                container.appendChild(item);
            });
        }
        
        // Create infrastructure summary
        function createInfrastructureSummary() {
            const container = document.getElementById('infrastructure-summary');
            
            // Calculate various metrics
            const totalCPUCores = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.cpu?.cores || 0), 0);
            const totalGPUs = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.gpu?.count || 0), 0);
            const totalCPUNodes = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.cpu?.nodes || 0), 0);
            const totalGPUNodes = hpcData.reduce((sum, hpc) => sum + (hpc.specs?.gpu?.nodes || 0), 0);
            const avgCPUPerSystem = Math.round(totalCPUCores / hpcData.length);
            const avgGPUPerSystem = Math.round(totalGPUs / hpcData.length);
            
            const summaryItems = [
                {
                    icon: 'memory',
                    color: 'text-blue-400',
                    title: 'Total CPU Cores',
                    value: totalCPUCores.toLocaleString(),
                    subtitle: `${totalCPUNodes} CPU nodes`
                },
                {
                    icon: 'graphic_eq',
                    color: 'text-purple-400',
                    title: 'Total GPUs',
                    value: totalGPUs.toLocaleString(),
                    subtitle: `${totalGPUNodes} GPU nodes`
                },
                {
                    icon: 'trending_up',
                    color: 'text-green-400',
                    title: 'Average Performance',
                    value: `${avgCPUPerSystem.toLocaleString()} cores`,
                    subtitle: `${avgGPUPerSystem} GPUs per system`
                }
            ];
            
            container.innerHTML = '';
            summaryItems.forEach(item => {
                const div = document.createElement('div');
                div.className = 'text-center';
                div.innerHTML = `
                    <div class="flex items-center justify-center mb-4">
                        <span class="material-icons-round ${item.color} text-3xl">${item.icon}</span>
                    </div>
                    <h4 class="text-lg font-semibold text-white mb-2">${item.title}</h4>
                    <div class="text-2xl font-bold gradient-text mb-1">${item.value}</div>
                    <div class="text-gray-400 text-sm">${item.subtitle}</div>
                `;
                container.appendChild(div);
            });
        }
        
        // Initialize GSAP animations
        function initializeAnimations() {
            gsap.from('.magic-card', {
                duration: 0.8,
                y: 50,
                opacity: 0,
                stagger: 0.1,
                ease: 'power2.out'
            });
            
            gsap.from('.metric-card', {
                duration: 0.6,
                scale: 0.9,
                opacity: 0,
                stagger: 0.1,
                delay: 0.3,
                ease: 'power2.out'
            });
        }
        
        // Display error message
        function displayError() {
            const container = document.getElementById('key-metrics');
            container.innerHTML = `
                <div class="col-span-full text-center py-12">
                    <span class="material-icons-round text-red-400 text-4xl mb-4">error</span>
                    <h3 class="text-xl font-semibold text-red-400 mb-2">Failed to load analytics data</h3>
                    <p class="text-gray-400">Please check your connection and try again.</p>
                    <button onclick="location.reload()" class="mt-4 px-6 py-2 bg-red-500 text-white rounded-full hover:bg-red-600 transition-colors">
                        <span class="material-icons-round text-sm mr-2">refresh</span>
                        Retry
                    </button>
                </div>
            `;
        }
    </script>
</body>
</html>
